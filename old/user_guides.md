# Руководства пользователя

## Оглавление

- [Driver mode (упрощённый)](#driver-mode-упрощённый)
- [Central mode (с проверкой)](#central-mode-с-проверкой)

---

# Driver mode (упрощённый)

### Введение

Driver mode — упрощённый режим работы, предназначенный для водителей и малых организаций. В этом режиме путевые листы проводятся напрямую из черновика (Draft → Posted) без дополнительных проверок. Бланки строгой отчётности выдаются водителям и используются для оформления путевых листов. Режим обеспечивает быстрое оформление документов с минимальными административными барьерами.

## 1. Заполнение справочников

1. Откройте раздел «Справочники» в боковом меню приложения.
2. Выберите нужный справочник (Организации, Транспорт, Сотрудники, Типы топлива, Маршруты, Места хранения).
3. Нажмите кнопку «+ Создать» для добавления новой записи.
4. Заполните обязательные поля формы (отмечены оранжевой звёздочкой * и выделены светло-оранжевым фоном).
5. Нажмите «Сохранить» для фиксации данных в системе.
6. Используйте поиск и фильтры для быстрого доступа к записям.

### Ошибки и вопросы

- **Не сохраняется запись**: Проверьте заполнение всех обязательных полей, отмеченных оранжевой звёздочкой (*) и выделенных светло-оранжевым фоном.
- **Не могу найти созданную запись**: Используйте строку поиска или сбросьте активные фильтры.
- **Дублирование записей**: Перед созданием проверьте наличие аналогичной записи через поиск.
- **Ошибка валидации ИНН/КПП**: Убедитесь, что введены корректные числовые значения нужной длины (ИНН: 10 или 12 цифр, КПП: 9 цифр).

## 2. Выдача пачек ПЛ

1. Перейдите в раздел «Бланки ПЛ» через боковое меню.
2. Нажмите кнопку «+ Добавить пачку» для создания новой пачки бланков.
3. Выберите организацию, укажите серию (например, «ЧБ») и диапазон номеров (начальный и конечный).
4. Нажмите «Создать» — пачка будет зарегистрирована в системе.
5. Найдите созданную пачку в списке и нажмите кнопку «Материализовать» — система создаст отдельные записи бланков.
6. После материализации нажмите «Выдать», выберите водителя и укажите диапазон номеров для выдачи.

### Ошибки и вопросы

- **Что такое материализация**: Это процесс создания отдельных записей бланков из пачки — без материализации бланки нельзя выдать водителю.
- **Пересечение номеров**: Система автоматически проверяет уникальность номеров при материализации и блокирует дублирование.
- **Не отображается водитель**: Убедитесь, что сотрудник имеет тип «Водитель» в справочнике сотрудников.
- **Как посмотреть выданные бланки**: Откройте карточку водителя в разделе «Сотрудники», там отображается сводка по бланкам.
- **Можно ли выдать часть пачки**: Да, при выдаче укажите нужный диапазон номеров из материализованной пачки.

## 3. Приходование топлива и материалов на склад

1. Откройте раздел «Номенклатура и Склад» в главном меню.
2. Убедитесь, что в разделе «Номенклатура» созданы позиции для топлива (привязанные к типам топлива).
3. Перейдите на вкладку «Движение по складу» и нажмите «+ Новая операция».
4. Выберите тип операции «Приход», укажите организацию и склад-получатель.
5. Добавьте позиции: выберите номенклатуру топлива, укажите количество в литрах и цену за литр.
6. Заполните поставщика, номер документа и нажмите «Провести» — остатки на складе автоматически обновятся.

### Ошибки и вопросы

- **Не обновляются остатки**: Убедитесь, что операция проведена (статус «Проведено»).
- **Нет нужной номенклатуры**: Создайте позицию на вкладке «Номенклатура» с указанием типа топлива и склада.
- **Ошибка отрицательного количества**: Количество должно быть положительным числом.
- **Как отменить операцию**: Удалите документ через контекстное меню (три точки) в списке операций.
- **Разница между складом и номенклатурой**: Номенклатура — это справочник товаров, склад — место их хранения.

## 4. Выдача топлива на карту

1. В разделе «Номенклатура и Склад» откройте вкладку «Движение по складу».
2. Создайте новую операцию расхода с причиной «Пополнение топливной карты».
3. Выберите водителя, которому пополняется карта, и укажите количество топлива в литрах.
4. Выберите номенклатуру топлива и склад-источник списания.
5. Нажмите «Провести» для фиксации операции.
6. Баланс топливной карты водителя автоматически обновится в его карточке, остаток на складе уменьшится.

### Ошибки и вопросы

- **Не обновился баланс карты**: Проверьте, что операция проведена и указан корректный водитель.
- **Недостаточно топлива на складе**: Убедитесь в наличии достаточного остатка перед выдачей.
- **Как посмотреть баланс карты**: Откройте карточку водителя в справочнике «Сотрудники», баланс отображается в поле «Баланс топливной карты».
- **Ошибка при проведении**: Проверьте заполнение всех обязательных полей и корректность количества.
- **Можно ли отменить пополнение**: Да, удалите документ — баланс карты и остаток на складе вернутся к прежним значениям.

## 5. Заполнение путевых листов

1. Перейдите в раздел «Путевые листы» и нажмите «+ Создать новый».
2. Выберите транспортное средство — система автоматически подставит показания одометра и остаток топлива.
3. Выберите водителя — система автоматически зарезервирует следующий свободный бланк из выданных водителю.
4. Заполните дату, период действия и добавьте маршруты (вручную, через AI-генерацию или импорт из файла).
5. Укажите данные по топливу: остаток на начало, заправка (будет списана с карты водителя), расчётный остаток.
6. Нажмите «Провести» — ПЛ перейдёт в статус Posted, бланк станет использованным, топливо спишется с карты.

### Ошибки и вопросы

- **Нет свободных бланков**: Выдайте новую пачку бланков водителю в разделе «Бланки ПЛ» (создать → материализовать → выдать).
- **Не сохраняется маршрут**: Проверьте заполнение полей «Откуда», «Куда» и «Расстояние».
- **Превышен расход топлива**: Система предупреждает о превышении нормы, укажите причину отклонения в примечаниях.
- **Как отменить проведённый ПЛ**: В Driver mode отмена возможна только через корректировку (требуются права администратора).
- **Заправка превышает баланс карты**: Система предупредит об ошибке — проверьте баланс карты водителя или пополните её.

## 6. Формирование отчётности

1. Откройте раздел «Отчёты» в главном меню приложения.

### Сводный отчёт по ТС

2. Выберите тип отчёта «Сводный отчёт по ТС».
3. Выберите транспортное средство из выпадающего списка.
4. Укажите период отчёта (дата начала и дата окончания).
5. Нажмите кнопку «Сформировать отчёт» для построения сводки.
6. Просмотрите данные по пробегу, расходу топлива, количеству рейсов и отклонениям от норм.
7. Экспортируйте отчёт в Excel через кнопку «Экспорт в Excel» для передачи в бухгалтерию.

### Отчёт по предрейсовым осмотрам

2. Выберите тип отчёта «Отчёт по предрейсовым осмотрам».
3. Укажите обязательный период (дата от и дата до).
4. При необходимости выберите конкретного водителя и/или транспортное средство для фильтрации.
5. Нажмите «Сформировать» для построения отчёта.
6. Переключайтесь между «Сводным отчётом» (по водителям) и «Детальным отчётом» (по каждому осмотру).
7. Просмотрите статистику: всего осмотров, количество водителей, среднее на водителя.
8. Экспортируйте отчёт в Excel для документирования и отчётности.

### Ошибки и вопросы

- **Пустой отчёт**: Проверьте наличие проведённых путевых листов за указанный период.
- **Неверные данные**: Убедитесь, что все ПЛ корректно заполнены и проведены.
- **Не экспортируется Excel**: Проверьте разрешения браузера на скачивание файлов.
- **Как изменить период**: Измените даты в полях фильтра и нажмите «Сформировать» повторно.
- **Отчёт показывает отклонения**: Проверьте корректность норм расхода для ТС и сезонные настройки.
- **Как считаются осмотры**: По каждой уникальной дате в маршрутах путевого листа (подробнее в документации отчёта).

## 7. Работа с панелью управления

1. Откройте раздел «Панель управления» (главный экран приложения).
2. Просмотрите ключевые показатели: пробег, расход топлива, остатки за месяц/квартал/год.
3. Используйте графики для визуального анализа динамики показателей.
4. Обратите внимание на блок «Проблемы» для выявления критических ситуаций (низкие остатки, просроченные документы).
5. Нажмите на показатель для перехода в детальный раздел с подробной информацией.
6. Обновите данные через кнопку «Обновить» при необходимости.

### Ошибки и вопросы

- **Не отображаются данные**: Убедитесь, что в системе есть проведённые документы (ПЛ, складские операции).
- **Неактуальные показатели**: Нажмите кнопку «Обновить» для пересчёта данных.
- **Как настроить период**: Период на панели фиксирован (месяц/квартал/год), для произвольного используйте раздел «Отчёты».
- **Что означает «Проблемы»**: Это критические ситуации (низкие остатки топлива, просроченные документы, превышения норм).
- **Графики не отображаются**: Убедитесь, что за выбранный период есть данные для построения графиков.

## 8. Распределение ролей и функциональных возможностей

1. Откройте раздел «Настройки» и перейдите на вкладку «Пользователи».
2. Нажмите «+ Добавить пользователя» для создания новой учётной записи.
3. Укажите имя пользователя, email и выберите роль из списка (admin, driver, viewer, mechanic).
4. Роли определяют доступные функции: admin (все права), driver (создание и проведение ПЛ), viewer (только просмотр).
5. Сохраните пользователя и при необходимости назначьте дополнительные права на вкладке «Управление ролями».
6. Используйте журнал бизнес-аудита для отслеживания действий пользователей.

### Ошибки и вопросы

- **Не могу создать пользователя**: Убедитесь, что у вас роль «admin» с правом «admin.panel».
- **Пользователь не видит раздел**: Проверьте назначенную роль и её права доступа на вкладке «Управление ролями».
- **Как изменить роль**: Откройте карточку пользователя и выберите новую роль из списка.
- **Разница между ролями**: admin — полный доступ, driver — работа с ПЛ, mechanic — склад и бланки, viewer — только просмотр.
- **Что такое дополнительные права**: Это индивидуальные разрешения (capabilities), которые можно добавить пользователю сверх его роли.

---

# Central mode (с проверкой)

### Введение

Central mode — режим с усиленным контролем, предназначенный для крупных организаций с централизованным управлением. Путевые листы проходят через промежуточный статус «Отправлено» (Draft → Submitted → Posted), что позволяет проверяющему или диспетчеру проверить документ перед окончательным проведением. Режим обеспечивает дополнительный уровень контроля качества данных и соответствия нормативам.

## 1. Заполнение справочников

1. Откройте раздел «Справочники» и выберите нужную категорию данных.
2. Нажмите «+ Создать» и заполните форму с обязательными полями.
3. В Central mode рекомендуется указывать проверяющих (reviewer) и контролёров для организаций.
4. Для водителей обязательно укажите закреплённого диспетчера и контролёра.
5. Сохраните запись после проверки корректности введённых данных.
6. Назначьте ответственных лиц для контроля качества справочных данных.

### Ошибки и вопросы

- **Не сохраняется запись**: Проверьте заполнение обязательных полей и корректность форматов данных.
- **Нужно ли указывать проверяющего**: Рекомендуется для обеспечения контроля качества документов в Central mode.
- **Как назначить контролёра**: В карточке водителя укажите сотрудника с типом «Контролёр» в поле «Контролёр».
- **Ошибка валидации**: Убедитесь в корректности ИНН, КПП, номеров документов согласно требованиям.
- **Разница между диспетчером и контролёром**: Диспетчер выдаёт ПЛ, контролёр проверяет их перед проведением.

## 2. Выдача пачек ПЛ

1. В разделе «Бланки ПЛ» нажмите «+ Добавить пачку».
2. Выберите организацию, укажите серию и диапазон номеров, нажмите «Создать».
3. Найдите созданную пачку и нажмите «Материализовать» — система создаст отдельные записи бланков со статусом «На складе».
4. После материализации нажмите «Выдать», выберите водителя и диапазон номеров.
5. В Central mode выдача бланков может требовать подтверждения от кладовщика (mechanic).
6. Операция выдачи фиксируется в журнале бизнес-аудита для контроля.

### Ошибки и вопросы

- **Требуется подтверждение кладовщика**: Обратитесь к сотруднику с ролью «Механик (Кладовщик)» для подтверждения.
- **Пересечение номеров**: Система автоматически проверяет и блокирует дублирование диапазонов при материализации.
- **Как отследить выдачу**: Используйте журнал бизнес-аудита в разделе «Настройки» → «Бизнес-аудит».
- **Ошибка прав доступа**: Убедитесь, что у вас есть право «blanks.issue».
- **Можно ли отозвать выданные бланки**: Нет, но можно списать бланки как испорченные через раздел «Все бланки».

## 3. Приходование топлива и материалов на склад

1. Откройте «Номенклатура и Склад», вкладка «Движение по складу».
2. Создайте операцию прихода с указанием организации и склада-получателя.
3. Добавьте позиции с указанием номенклатуры, количества, цены и поставщика.
4. Приложите сканы документов (накладные, счета) через функцию вложений (если доступна).
5. Укажите ответственное лицо, принявшее товар на склад.
6. Проведите документ после проверки всех данных уполномоченным лицом.

### Ошибки и вопросы

- **Требуется вложение документа**: В Central mode рекомендуется прикладывать сканы подтверждающих документов.
- **Не могу провести операцию**: Проверьте наличие прав доступа и корректность заполнения полей.
- **Как добавить вложение**: Нажмите кнопку «Прикрепить файл» в форме операции (если функция доступна).
- **Ошибка при проведении**: Убедитесь, что указан корректный склад и номенклатура существует.
- **Кто может проводить приход**: Сотрудники с ролью «mechanic» или «admin».

## 4. Выдача топлива на карту

1. В разделе «Номенклатура и Склад» создайте операцию расхода.
2. Выберите причину «Пополнение топливной карты» и укажите водителя.
3. В Central mode операция может требовать согласования с диспетчером или кладовщиком.
4. Укажите количество топлива, номенклатуру и склад-источник.
5. Дождитесь подтверждения от уполномоченного лица (если требуется).
6. После проведения баланс карты обновится, операция зафиксируется в аудите.

### Ошибки и вопросы

- **Требуется согласование**: Обратитесь к диспетчеру или лицу с правами согласования расхода.
- **Превышен лимит выдачи**: Проверьте установленные лимиты для водителя и склада.
- **Как отменить выдачу**: Удалите документ через контекстное меню (требуются права администратора).
- **Не обновился баланс**: Убедитесь, что операция проведена и указан корректный водитель.
- **Кто может выдавать топливо**: Сотрудники с ролью «mechanic» или правом на складские операции.

## 5. Заполнение путевых листов

1. Создайте новый путевой лист в разделе «Путевые листы».
2. Заполните все обязательные поля: дату, транспорт, водителя, показания одометра.
3. Добавьте маршруты с указанием точек отправления, назначения и расстояния.
4. Укажите данные по топливу и сохраните ПЛ в статусе «Черновик» (Draft).
5. Нажмите «Отправить на проверку» для перевода в статус «Отправлено» (Submitted).
6. Проверяющий (reviewer) проверит данные и проведёт ПЛ (Posted) или вернёт на доработку.

### Ошибки и вопросы

- **Не могу провести ПЛ напрямую**: В Central mode требуется промежуточная проверка через статус «Submitted».
- **Кто может проверять ПЛ**: Сотрудники с ролью «reviewer» или правом «waybill.post».
- **Как вернуть ПЛ на доработку**: Проверяющий может отменить ПЛ с указанием причины в комментарии.
- **Ошибка при отправке**: Проверьте заполнение всех обязательных полей и корректность данных.
- **Можно ли редактировать отправленный ПЛ**: Нет, только проверяющий может провести или отменить его.

## 6. Формирование отчётности

1. Перейдите в раздел «Отчёты» и выберите нужный тип отчёта.

### Сводный отчёт по ТС

2. Выберите транспортное средство и укажите период отчёта.
3. Добавьте дополнительные фильтры (организация, водитель, статус ПЛ).
4. Нажмите «Сформировать отчёт» для построения детальной сводки.
5. Проверьте корректность данных, включая отклонения от норм расхода.
6. Добавьте комментарии к отчёту при необходимости (доступно для проверяющих и администраторов).
7. Экспортируйте отчёт в Excel или PDF для передачи в бухгалтерию.

### Отчёт по предрейсовым осмотрам

2. Укажите период и выберите фильтры (водитель, ТС).
3. Сформируйте отчёт и выберите режим просмотра (сводный/детальный).
4. Проверьте соответствие количества осмотров установленным нормам.
5. Экспортируйте отчёт для контрольных органов и внутреннего аудита.

### Ошибки и вопросы

- **Отчёт содержит ошибки**: Проверьте корректность исходных данных в путевых листах.
- **Как добавить комментарий**: Используйте поле «Примечания» в форме отчёта (требуются права reviewer или admin).
- **Не экспортируется PDF**: Проверьте настройки браузера и разрешения на скачивание.
- **Расхождение с нормами**: Проверьте настройки норм расхода для ТС и сезонные коэффициенты.
- **Кто может формировать отчёты**: Все пользователи, но комментировать могут только reviewer и admin.
- **Недостаточно осмотров у водителя**: Проверьте заполнение маршрутов в путевых листах и их проведение.

## 7. Работа с панелью управления

1. На панели управления просмотрите агрегированные показатели по всем организациям.
2. Используйте фильтры для анализа данных по конкретной организации или периоду.
3. Обратите внимание на блок «Проблемы» с критическими ситуациями.
4. Проверьте статусы документов, ожидающих проверки (Submitted).
5. Используйте графики для выявления трендов и аномалий в данных.
6. Настройте уведомления о критических событиях через раздел «Настройки» (если доступно).

### Ошибки и вопросы

- **Не вижу документы на проверке**: Убедитесь, что у вас роль «reviewer» или «admin».
- **Как настроить фильтры**: Используйте выпадающие списки и поля дат в верхней части панели.
- **Что означают цветовые индикаторы**: Красный — критично, жёлтый — требует внимания, зелёный — норма.
- **Не обновляются данные**: Нажмите кнопку «Обновить» или перезагрузите страницу.
- **Как посмотреть детали проблемы**: Нажмите на индикатор проблемы для перехода к детальной информации.

## 8. Распределение ролей и функциональных возможностей

1. В разделе «Настройки» откройте вкладку «Управление ролями».
2. Просмотрите доступные роли: admin, reviewer, accountant, mechanic, driver, viewer.
3. Для каждой роли настройте набор прав доступа (capabilities).
4. Создайте пользователей на вкладке «Пользователи» с назначением ролей.
5. Используйте дополнительные права (extraCaps) для гибкой настройки доступа.
6. Регулярно проверяйте журнал бизнес-аудита для контроля действий пользователей.

### Ошибки и вопросы

- **Разница между ролями**: reviewer — проверка ПЛ, mechanic — склад и бланки, accountant — отчёты, driver — создание ПЛ, viewer — просмотр.
- **Как назначить дополнительные права**: В карточке пользователя добавьте capabilities в поле «Доп. права».
- **Не могу изменить роль**: Убедитесь, что у вас роль «admin» с правом «rbac.delegate».
- **Как отследить действия пользователя**: Используйте журнал бизнес-аудита с фильтром по пользователю.
- **Можно ли создать свою роль**: Нет, но можно настроить права существующих ролей и использовать дополнительные права.
