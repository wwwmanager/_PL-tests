# APPLICATION CONTEXT

## 1. –û–±—â–∏–π –æ–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

- **–ù–∞–∑–≤–∞–Ω–∏–µ:** Waybill App  
- **–í–µ—Ä—Å–∏—è:** 1.0.0  
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—É—Ç–µ–≤—ã–º–∏ –ª–∏—Å—Ç–∞–º–∏, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–æ–º, –≤–æ–¥–∏—Ç–µ–ª—è–º–∏, –±–ª–∞–Ω–∫–∞–º–∏ –∏ —Å–∫–ª–∞–¥–æ–º –¥–ª—è –∞–≤—Ç–æ–ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π.  
- **–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã:** –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π (Central Mode) ‚Äî –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ PostgreSQL —á–µ—Ä–µ–∑ Backend API.

---

## 2. –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### Frontend

- **React** 19 + **TypeScript** + **Vite**
- **TailwindCSS**
- **–§–æ—Ä–º—ã:** React Hook Form + Zod
- **–¢–µ—Å—Ç—ã:** Vitest + Testing Library + Playwright (E2E)
- **–ó–∞–ø—É—Å–∫ dev:** `npm run dev` ‚Üí http://localhost:3000/_PL-tests/

### Backend

- **Express** + **TypeScript** + **TypeORM** (–ø–æ—Ä—Ç 3001)
- **PostgreSQL** ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –ë–î
- **JWT** –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** (Winston)

---

## 3. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 3.1. Frontend

- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ `/api/auth/login`
- –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ API —Ñ–∞—Å–∞–¥—ã (`services/*Api.ts`)
- httpClient –¥–æ–±–∞–≤–ª—è–µ—Ç `Authorization: Bearer <token>` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### 3.2. Backend

- **–°–ª–æ–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** routes ‚Üí controllers ‚Üí services ‚Üí TypeORM
- **–û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏:**
  - Organization, Department
  - User (tokenVersion), Role, Permission, UserRole, RolePermission
  - Employee (driver, dispatcher, etc.)
  - Vehicle, FuelCard
  - Waybill, WaybillRoute, WaybillFuel
  - BlankBatch, Blank
  - StockItem, Warehouse, StockMovement
  - AuditLog, RefreshToken
- **–ü—Ä–∏–Ω—Ü–∏–ø—ã:**
  - Organization isolation: –∑–∞–ø—Ä–æ—Å—ã —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø–æ `organizationId` (–∏–∑ JWT)
  - Audit logging –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
  - RBAC –Ω–∞ —É—Ä–æ–≤–Ω–µ backend

---

## 4. API Endpoints

### 4.1. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- `POST /api/auth/login` ‚Äî –≤—Ö–æ–¥, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JWT
- `POST /api/auth/refresh` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)

### 4.2. –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
| –†–µ—Å—É—Ä—Å | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|----------|
| –ü—É—Ç–µ–≤—ã–µ –ª–∏—Å—Ç—ã | `/api/waybills` | CRUD, —Å–º–µ–Ω–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ |
| –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç | `/api/vehicles` | CRUD |
| –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ | `/api/employees` | CRUD, —Ñ–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É |
| –ë–ª–∞–Ω–∫–∏ | `/api/blanks` | –ü–∞—Ä—Ç–∏–∏, –≤—ã–¥–∞—á–∞, –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è |
| –°–∫–ª–∞–¥ | `/api/stock` | –ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞, –¥–≤–∏–∂–µ–Ω–∏—è |
| Dashboard | `/api/dashboard` | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –∏—Å—Ç–µ–∫–∞—é—â–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã |

### 4.3. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ —Ç–æ–∫–µ–Ω—ã

- `/api/auth/login` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JWT –∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –¢–æ–∫–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ localStorage (`auth_token`)
- httpClient –¥–æ–±–∞–≤–ª—è–µ—Ç `Authorization: Bearer <token>` –∫ –∫–∞–∂–¥–æ–º—É –∑–∞–ø—Ä–æ—Å—É
- Refresh tokens ‚Äî –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã (–º–æ–¥–µ–ª—å `RefreshToken` —É–∂–µ –µ—Å—Ç—å)

---

## 5. –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

### ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ (–ú–µ—Å—è—Ü 1-2)
- –ü–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π –Ω–∞ Backend API
- –£–¥–∞–ª—ë–Ω mockApi.ts –∏ Driver Mode
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ RBAC
- Dashboard –∏ –æ—Ç—á—ë—Ç—ã
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### ‚è≥ –í —Ä–∞–±–æ—Ç–µ (–ú–µ—Å—è—Ü 3)
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Frontend (Sentry)
- Rate Limiting –∏ Security Headers
- –ë—ç–∫–∞–ø—ã –ë–î

### üìã –û—Ç–ª–æ–∂–µ–Ω–æ
- –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (Zod –Ω–∞ backend)
- –í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤

---

## 6. AI Session Rules

### 6.1. –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Å—Å–∏–∏

AI –æ–±—è–∑–∞–Ω:
1. –ü—Ä–æ—á–∏—Ç–∞—Ç—å `APPLICATION_CONTEXT.md`
2. –ü—Ä–æ—á–∏—Ç–∞—Ç—å `implementation_plan.md` (–µ—Å–ª–∏ –µ—Å—Ç—å)
3. –ü—Ä–æ—á–∏—Ç–∞—Ç—å `task.md` (–µ—Å–ª–∏ –µ—Å—Ç—å)
4. –°–æ–æ–±—â–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ

### 6.2. –§–æ—Ä–º–∞—Ç –ø–µ—Ä–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è

```
–ö–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞–≥—Ä—É–∂–µ–Ω:
- APPLICATION_CONTEXT.md –ø—Ä–æ—á–∏—Ç–∞–Ω
- task.md –ø—Ä–æ—á–∏—Ç–∞–Ω

–°–æ–≥–ª–∞—Å–Ω–æ —Ç–µ–∫—É—â–µ–º—É –ø–ª–∞–Ω—É, –ø—Ä–µ–¥–ª–∞–≥–∞—é —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
1) ‚Ä¶
2) ‚Ä¶
```

### 6.3. –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã

1. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
2. –°–æ–æ—Ç–Ω–µ—Å—Ç–∏ –∫–æ–º–∞–Ω–¥—É —Å –ø–ª–∞–Ω–æ–º
3. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

---

## History

- **2025-12-19:** AUTH-003 ‚Äî –ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è access token —á–µ—Ä–µ–∑ tokenVersion. –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ authMiddleware –∏ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç –≤ transferUser.
- **2025-12-19:** REL-204 ‚Äî –†–µ–∞–ª–∏–∑–∞—Ü–∏—è "–£–º–Ω—ã—Ö –ø—É—Å—Ç—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π" (Smart Empty States) –≤–æ –≤—Å–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–ø–∏—Å–∫–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
- **2025-12-25:** FUEL-CARD-AUTO-001 ‚Äî –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ç–æ–ø–ª–∏–≤–Ω—ã—Ö –∫–∞—Ä—Ç –≤ –ü—É—Ç–µ–≤—ã–µ –ª–∏—Å—Ç—ã: –∞–≤—Ç–æ–ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –≤–æ–¥–∏—Ç–µ–ª—è, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ —Å –∫–∞—Ä—Ç—ã –≤ StockMovements, –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –∏ –¥–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç—ã –≤ UI.

---

=== END OF PROJECT CONTEXT ===