# Руководство администратора системы "Путевые листы"

Добро пожаловать в руководство администратора! Здесь вы найдете подробные инструкции по настройке и управлению системой.

---

## Содержание

1. Общие настройки системы
2. Управление пользователями
3. Управление ролями и правами
4. Управление бланками строгой отчетности
5. Импорт и экспорт данных
6. Журналы аудита
7. Диагностика и обслуживание

---

## 1. Общие настройки системы

### Режимы работы приложения

Система поддерживает два режима работы:

#### Driver Mode (Упрощенный режим)

- **Назначение:** Для небольших организаций с простым документооборотом
- **Особенности:**
  - Путевой лист сразу проводится (Draft → Posted)
  - Водитель может самостоятельно проводить документы
  - Упрощенный контроль
- **Когда использовать:** Малый бизнес, 1-5 автомобилей

#### Central Mode (Режим с проверкой)

- **Назначение:** Для крупных организаций с централизованным контролем
- **Особенности:**
  - Путевой лист проходит проверку (Draft → Submitted → Posted)
  - Водитель отправляет на проверку, диспетчер/бухгалтер проводит
  - Строгий контроль и аудит
- **Когда использовать:** Средний и крупный бизнес, более 5 автомобилей

### Настройка парсера маршрутов

**Что это:** Функция импорта маршрутов из HTML-файлов отчетов навигационных систем.

**Как включить:**

1. Откройте **Настройки** → **Общие настройки**
2. Найдите переключатель **"Парсер маршрутов"**
3. Включите для отображения кнопки "Импорт из файла" в путевых листах

**Поддерживаемые форматы:**

- HTML отчеты с таблицами маршрутов
- Структура: дата, время, адрес, расстояние

### Настройки бланков

**Разрешить водителям добавлять пачки бланков:**

- **Включено:** Водитель может самостоятельно создавать пачки бланков
- **Выключено:** Только администратор/диспетчер управляет бланками

**Рекомендация:** Выключите для строгого контроля в Central Mode.

---

## 2. Управление пользователями

### Создание нового пользователя

1. Откройте **Настройки** → **Управление пользователями**
2. Нажмите кнопку **"Добавить пользователя"**
3. Заполните поля:
   - **Имя пользователя** (обязательно)
   - **Email** (для входа в систему)
   - **Роль** (выберите из списка)
4. Нажмите **"Сохранить"**

### Редактирование пользователя

1. Найдите пользователя в списке
2. Нажмите кнопку **"Редактировать"** (значок карандаша)
3. Измените необходимые поля
4. Нажмите **"Сохранить"**

### Удаление пользователя

1. Найдите пользователя в списке
2. Нажмите кнопку **"Удалить"** (значок корзины)
3. Подтвердите удаление

**Внимание:** Удаление пользователя не удаляет созданные им документы.

### Дополнительные права

Помимо роли, каждому пользователю можно назначить дополнительные индивидуальные права.

**Пример:** Водитель с правом просмотра отчетов

1. Откройте редактирование пользователя
2. В разделе **"Дополнительные права"** выберите нужные
3. Сохраните изменения

---

## 3. Управление ролями и правами

### Встроенные роли

- **Admin** - Администратор (полный доступ)
- **Driver** - Водитель (создание и проведение ПЛ)
- **Auditor** - Аудитор (просмотр документов и журналов)
- **Accountant** - Бухгалтер (проведение ПЛ, склад)
- **Reviewer** - Проверяющий (проверка и утверждение ПЛ)
- **Mechanic** - Механик (работа с ТС)
- **Viewer** - Наблюдатель (только просмотр)
- **User** - Пользователь (базовый доступ)

### Настройка прав роли

1. Откройте **Настройки** → **Управление ролями**
2. Выберите роль для редактирования
3. Отметьте/снимите галочки с нужных прав
4. Нажмите **"Сохранить"**

**Важно:** Роль **Admin** нельзя редактировать - она всегда имеет все права.

### Основные группы прав

**Путевые листы:**

- `waybills.create` - Создание ПЛ
- `waybills.edit` - Редактирование ПЛ
- `waybills.delete` - Удаление ПЛ
- `waybills.post` - Проведение ПЛ
- `waybills.cancel` - Отмена проведения ПЛ

**Справочники:**

- `dictionaries.view` - Просмотр справочников
- `dictionaries.edit` - Редактирование справочников

**Склад:**

- `warehouse.view` - Просмотр склада
- `warehouse.manage` - Управление складом

**Бланки:**

- `blanks.view` - Просмотр бланков
- `blanks.manage` - Управление бланками
- `blanks.issue` - Выдача бланков

**Администрирование:**

- `admin.panel` - Доступ к настройкам
- `admin.users` - Управление пользователями
- `admin.roles` - Управление ролями
- `admin.import` - Импорт данных
- `admin.export` - Экспорт данных

---

## 4. Управление бланками строгой отчетности

### Создание пачки бланков

1. Откройте **Настройки** → **Управление бланками** → **Пачки бланков**
2. Нажмите **"Создать пачку"**
3. Заполните поля:
   - **Серия** (например, АА)
   - **Номер начала** (например, 000001)
   - **Номер окончания** (например, 000100)
   - **Тип бланка** (Путевой лист)
4. Нажмите **"Создать"**

**Результат:** Создана пачка из 100 бланков (АА000001 - АА000100) со статусом "Доступна".

### Материализация бланков

**Что это:** Создание индивидуальных записей для каждого бланка в пачке.

**Зачем:** Для детального учета каждого бланка (кому выдан, когда использован, кто списал).

**Как материализовать:**

1. Найдите пачку в списке
2. Нажмите **"Материализовать"**
3. Подтвердите действие

**Внимание:** Материализация необратима и может занять время для больших пачек.

### Выдача бланков водителю

1. Откройте **Настройки** → **Управление бланками** → **Все бланки**
2. Найдите нужный бланк (статус: Available)
3. Нажмите **"Выдать"**
4. Выберите водителя
5. Подтвердите выдачу

**Статус бланка изменится:** Available → Issued

### Списание бланков

**Автоматическое списание:**

- При проведении путевого листа бланк автоматически списывается
- Статус: Issued → Used

**Ручное списание (испорчен):**

1. Найдите бланк
2. Нажмите **"Списать как испорченный"**
3. Укажите причину
4. Подтвердите

**Статус:** Issued → Spoiled

---

## 5. Импорт и экспорт данных

### Экспорт данных

#### Полный экспорт

1. Откройте **Настройки** → **Импорт/Экспорт**
2. Нажмите **"Экспорт (общий)"**
3. Сохраните файл

**Что включено:** Все справочники, путевые листы, бланки, складские позиции, настройки, журналы аудита.

#### Выборочный экспорт

1. Нажмите **"Экспорт (выборочный)"**
2. Отметьте нужные разделы
3. Нажмите **"Экспортировать выбранное"**

### Импорт данных

**Важно:** Перед импортом система автоматически создаст резервную копию!

#### Процесс импорта

1. Откройте **Настройки** → **Импорт/Экспорт**
2. Нажмите **"Импорт"**
3. Выберите файл `.json`
4. Откроется окно предварительного просмотра

#### Стратегии импорта

**Добавлять новые:**

- Добавляет только новые записи
- Существующие не изменяются

**Обновлять (слияние):**

- Обновляет существующие записи, добавляет новые
- Поля заменяются значениями из файла

**Обновлять (перезапись):**

- Полностью заменяет существующие записи

**Удалять отсутствующие:**

- Удаляет записи, которые есть в базе, но отсутствуют в файле
- **Опасно:** Может привести к потере данных

#### Откат импорта

Если импорт прошел неудачно:

1. Откройте **Настройки** → **Журналы аудита** → **Журнал импорта**
2. Найдите последнюю запись импорта
3. Нажмите **"Откат (Rollback)"**
4. Подтвердите действие

**Результат:** Все изменения будут отменены.

---

## 6. Журналы аудита

### Журнал импорта

**Назначение:** Отслеживание всех операций импорта данных с возможностью отката.

**Что записывается:**

- Дата и время импорта
- Пользователь, выполнивший импорт
- Список измененных разделов
- Количество добавленных/измененных/удаленных записей
- Снимки данных до и после изменения

**Функции:**

- Просмотр деталей
- Сравнение (Diff)
- Откат изменений (Rollback)

### Бизнес-аудит

**Назначение:** Отслеживание действий пользователей в системе.

**Что записывается:**

- Создание путевого листа
- Проведение путевого листа
- Отмена проведения
- Выдача бланков
- Списание бланков
- Изменение справочников
- Складские операции

---

## 7. Диагностика и обслуживание

### Информация об окружении

- Версия браузера
- Версия приложения
- Поддержка IndexedDB
- Доступное место в хранилище

### Хранилище и квота

- Используемое место (MB)
- Доступная квота (MB)
- Процент использования

**Рекомендации:**

- Менее 50% - нормально
- 50-80% - рекомендуется очистка
- Более 80% - критично

### Валидация базы данных

**Что проверяется:**

- Соответствие данных схемам
- Целостность ссылок
- Корректность статусов

**Как запустить:**

1. Откройте **Диагностика** → **Валидация БД**
2. Нажмите **"Запустить проверку"**
3. Дождитесь результатов

### Опасная зона

**Внимание:** Действия в этом разделе необратимы!

**Доступные операции:**

- Удаление неизвестных ключей
- Очистка журнала аудита
- Сброс настроек UI
- Очистить все данные

**Рекомендация:** Перед очисткой всегда создавайте резервную копию!

---

## Поддержка

Если у вас возникли вопросы:

1. Проверьте раздел **Справка** → **Частые вопросы**
2. Изучите **Руководство пользователя**
3. Обратитесь к разработчикам

---

## Рекомендации по безопасности

**Регулярные резервные копии:**

- Экспортируйте данные минимум раз в неделю
- Храните копии в безопасном месте

**Управление правами:**

- Назначайте минимально необходимые права
- Регулярно проверяйте список пользователей
- Удаляйте неактивных пользователей

**Аудит:**

- Регулярно проверяйте журналы событий
- Обращайте внимание на подозрительные действия

**Обновления:**

- Следите за обновлениями системы
- Тестируйте обновления на тестовой базе

---

**Версия руководства:** 2.1  
**Дата обновления:** 2025-11-27